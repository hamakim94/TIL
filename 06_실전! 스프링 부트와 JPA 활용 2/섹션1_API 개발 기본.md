# API 개발 기본



## 회원 등록 API

JPA를 사용하면, Entity가 있기 때문에, API 만드는 과정은 조금 다르다!!!(전혀 다른 이야기)

강사 : 템플릿 엔진 컨트롤러, API 사용 컨트롤러 아에 분리



api랑 템플릿이랑 공통 처리 하는게 많이 다르다

- JSON vs 다른거 



### v1 문제점

엔티티 자체에 validation logic -> 어떤 엔티티에는 딱히 필요 업을수도!

만약 name 이라는 필드가 username으로 엔티티에서 이름을 바꾸면.. 많은 일이 일어난다.

- 어느날 갑자기 api 동작 XX

- 즉, API 를 위한, 별도의 DTO를 만들어라!



그런데, 간편 가입, 여러 가입, 소셜 로그인 등등 많은 경우 -> 엔티티 하나만으로 감당 XX

엔티티를 외부 노출 하지 마라!

장점이 많음.! 외부 API 스펙 -> 엔티티 노출 XX, 별도의 DTO를 만들어서 하는걸 추천함!!(정석)



**DTO를 따로 만드는게 매우매우 중요! 어느 순간 멘붕이 온다!** 엄청 강조!!



## 회원 수정 API

수정은 PUT으로 가져가는게 좋다!(REST)

멱등, 같은 수정을 여러번 해도 -> 결과가 똑같음!



커멘드와 쿼리를 분리해라

(update -> 반환값이 있으면, query랑 똑같지!! 차라리 id만 반환하도록



cf) 특정 컨트롤러에서 사용하는 DTO -> inner Class로

cf) update는 영속성 컨텍스트 이용해서 service에서 매우 편하게 사용 가능~



## 회원 조회 API

- Entity 필드에 @JsonIgnore
  - 그럼 api에 안 나옴
  - 그런데 이렇게 하면, 어떤 로직엔 실제로 필요할 수 있는 orders!
  - 더 나아가, 화면에 보이기 위한 logic이 들어간거지..!!(order 안 보여주고 싶은 단순한 이유)
- Entity를 직접 쓰면 ㄹㅇ 심각한 문제!
  - 바로 list<엔티티>를 반환하면, 필요한 로직이 없을 수 있다..!!
  - 심지어 count라는게 있다면.. 문제
  - 일반적으로 데이터라는 필드에 감싸서 보내주면 스펙 확장이 용이하다



**엔티티 외부 노출 XXXXXXXXX** - 꼭 DTO 만들어라! 강제로!

