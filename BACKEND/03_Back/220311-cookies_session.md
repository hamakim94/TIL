# 22/03/11



### HTTP(Hyper Text Transfer Protocol)

- HTML, TEXT, IMAGE, JSON, 영상, 음성 등과 같은 리소스들을 주고 받을 때 사용하난 프로트콜
- HTTP는 모든 것을 전송하고 웹에서 이루어 지느 모든 데이터 교환의 기초



- 클라이언트-서버 모델
- 무상태 프로토콜
- TCP/IP 레이어 기반

---

### HTTP 특

#### 클라이언트 서버 모델

- 둘 다 컴퓨터다, client -> 서버에 요청, 서버 -> client에게 연달
- 클라이언트, 서버 : 요청 받는곳에 따라 서로 바뀔 수 있음(너무 어렵게 생각하지 말기)

#### 비연결지향(Connectionless), 무상태(Stateless)

- 지속적인 연결 유지로 인한 자원낭비 방지를 위해 연결 해제
- 연결이 해제되면 서버는 클라이언트 정보를 알 수 없음
  - 장바구니에 상품을 담아 두었는데, 페이지가 바뀌면 정보가 없어짐 + 로그인 정보가 없음 등 
- 이러한 문제를 해결하기 위해 **Cookie, Session**을 활용한다.

---

### Cookie

#### javax.servlet.httpCookie

- 서버가 생성하는 클라이언트 정보를 가지고 있는 파일
- 클라이언트 컴퓨터에 저장되며, 필요에 따라 요청 시 서버로 같이 전송된다
- key-value 형태로 구성되며 문자열 데이터
- 브라우저(클라이언트) 별로 별도의 쿠키가 생성된다(브라우저 다르면 다른 사용자로 처리)

---

#### 주 목적

- 세션 관리 
  - 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등의 정보 관리
- 개인화
  - 사용자 선호, 테마 등의 세팅
- 트래킹
  - 사용자 행동을  기록하고 분석하는 용도

---

#### 동작 순서

- client가 요청 생성
- WAS는 Cookie를 생성하고, Http Header에 Cookie를 넣어 응답
- Client는 Cookie를 저장, 해당 서버에 요청할 때 요청과 함께 Cookie를 전송
- Cookie는 브라우저가 종료되더라도 계속 저장, 동일 사이트를 재 방문하여 요청 시 필요에 따라 Cookie가 재전송된다.

---

#### 쿠키 특

- 이름(key), 값(value) , 만료일(Expire date), 경로정보로 구성
- 클라이언트는 최대 300개의 쿠키를 저장할 수 있다
- 하나의 도메인 당 20개의 쿠키를 저장 가능
- 쿠키 하나는 4KB까지 저장 가능

---

### 메또드

#### 생성 및 추가

- 생성
  - Cookie cookie = new Cookie("userid", "ttt");

- 추가 **자주 실수하는 부분**
  - **response.addCookie**(cookie);

+ 여러가지.....
  + setMaxAge(int expiry) : 쿠키 유효기간 설정 : 초단위로..



---

## 세션(session) : javax.servlet.http.HttpSession

- 사용자가 웹 ㅅ버ㅓ에 접속해 있는 상태를 하나의 단위보고 세션이라고 한다
- 각 세션은 session id를 이용해 구분
- WAS메모리에 Object 형태로 저장
- 메모리가 허용하는 용량까지 제한없이 저장가능
- 크키는 클라이언트에 저장, 공유PC의 경우 보안 취약, 하지만 세션은 서버에 저장 쿠키에 비에 보안 좋다
- 로그인, 장바구니 등 

---

### 동작 순서

- 클라이언트가 페이지를 요청
- 서버는 쿠키에 session-id가 있는지 확인
- 존재하지 않으면 session id를 생성해 쿠키에 쓴 다음 클라이언트로 반환
- 생성된 session id를 이용해요 서버 내 메모리 생성
- 클라이언트가 다음 요청시 쿠키에 session id(JSESSSIONID)를 포함해 전달하면 서버내에 저장된 session id와 비교하여 데이터를 조회



---

### Session 설정

- 브라우저 당 하나의 JSESSIONID를 할당 받음
- 아이디 또는 닉네임과 같이 로그인 했을 경우 자주 사용되는 정보를 session에 저장하면 DB에 접근할 ㅣㄹ요가 없으므로 효율적이다

---

### 세션 사용하기

- 요청 객체로부터 session 객체를 얻어온다
- session 데이터를 설정하여 저장한다
- session에서 값을 반환하는 getAttribute 메서드는 반한형이 Object이다.

#### 메또드

setAttribute, getAttribute 등 씀

---

## MVC pattern - 서버 처리 로직

- 개발 영역을 모델, 뷰, 컨트롤러 세 영역으로 나누고 각각의 의존을 최소한으로 한다

| 영역                 | 설명                            |
| -------------------- | ------------------------------- |
| 모델(Model)          | data를 저장, 필요한 형태로 가공 |
| 뷰(View)             | 보여주는 곳(JSP)                |
| 컨트롤러(Controller) | 데이터 다루는 곳(Servlet)       |



